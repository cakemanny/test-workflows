
name: PR title Polizei

on:
  pull_request:
    types: [opened, edited]

jobs:
  check-pr-title:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            console.log('context', context);

            let wantToComment = false;
            const changes = context.payload.changes;
            const titleHasChanged = changes && changes.title && changes.title.from;
            if (titleHasChanged || payload.action === 'edited') {
              const commit_title_mode = context.payload.pull_request.squash_merge_commit_title;
              if (commit_title_mode === 'PR_TITLE') {
                const title = context.payload.pull_request.title;
                if (!title.match(/^(feat|fix|docs|style|refactor|perf|test|build|ci).*:/)) {
                  wantToComment = true;
                }
              }
            }
            if (!wantToComment) {
              return;
            }

            await github.rest.issues.createComment({
              issue_number: context.payload.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: (
                'ðŸ‘® Jo, seien Sie bitte vorsichtig, Sie haben bis jetzt ' +
                'kein convention in deinem Commit  ðŸš”'
              ),
            });
